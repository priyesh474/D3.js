<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D3.js POC - Interactive Network Graph</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 30px;
            max-width: 900px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 25px;
            font-size: 14px;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: #667eea;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button.active {
            background: #764ba2;
        }

        #graph {
            background: #f8f9fa;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .info-panel {
            margin-top: 20px;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 8px;
            min-height: 60px;
        }

        .info-panel h3 {
            color: #667eea;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .info-panel p {
            color: #555;
            line-height: 1.6;
            font-size: 14px;
        }

        .node {
            cursor: pointer;
            stroke: #fff;
            stroke-width: 2px;
        }

        .node:hover {
            stroke: #667eea;
            stroke-width: 3px;
        }

        .link {
            stroke: #999;
            stroke-opacity: 0.6;
        }

        .label {
            font-size: 12px;
            font-weight: bold;
            pointer-events: none;
            fill: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ¨ D3.js Interactive Network</h1>
        <p class="subtitle">Drag nodes, click for details, and switch visualizations</p>
        
        <div class="controls">
            <button onclick="changeVisualization('force')" class="active" id="btn-force">Force Layout</button>
            <button onclick="changeVisualization('radial')" id="btn-radial">Radial Layout</button>
            <button onclick="changeVisualization('tree')" id="btn-tree">Tree Layout</button>
            <button onclick="randomizeData()">ðŸŽ² Randomize</button>
        </div>

        <svg id="graph"></svg>

        <div class="info-panel">
            <h3>Welcome!</h3>
            <p>Click on any node to see its details. Drag nodes around in Force Layout mode to explore the network structure.</p>
        </div>
    </div>

    <script>
        let currentLayout = 'force';
        let simulation;
        
        // Sample network data
        let graphData = {
            nodes: [
                { id: 'Node A', group: 1, value: 30 },
                { id: 'Node B', group: 1, value: 20 },
                { id: 'Node C', group: 2, value: 25 },
                { id: 'Node D', group: 2, value: 15 },
                { id: 'Node E', group: 3, value: 35 },
                { id: 'Node F', group: 3, value: 18 },
                { id: 'Node G', group: 1, value: 22 },
                { id: 'Node H', group: 2, value: 28 }
            ],
            links: [
                { source: 'Node A', target: 'Node B', value: 1 },
                { source: 'Node A', target: 'Node C', value: 2 },
                { source: 'Node B', target: 'Node D', value: 1 },
                { source: 'Node C', target: 'Node E', value: 3 },
                { source: 'Node D', target: 'Node F', value: 1 },
                { source: 'Node E', target: 'Node G', value: 2 },
                { source: 'Node F', target: 'Node H', value: 1 },
                { source: 'Node G', target: 'Node H', value: 2 },
                { source: 'Node A', target: 'Node E', value: 1 }
            ]
        };

        const width = 800;
        const height = 500;
        const color = d3.scaleOrdinal(d3.schemeCategory10);

        function initGraph() {
            const svg = d3.select('#graph')
                .attr('width', width)
                .attr('height', height)
                .attr('viewBox', [0, 0, width, height]);

            drawGraph();
        }

        function drawGraph() {
            const svg = d3.select('#graph');
            svg.selectAll('*').remove();

            // Create a copy of the data to avoid mutation issues
            const data = JSON.parse(JSON.stringify(graphData));

            if (currentLayout === 'force') {
                drawForceLayout(svg, data);
            } else if (currentLayout === 'radial') {
                drawRadialLayout(svg, data);
            } else if (currentLayout === 'tree') {
                drawTreeLayout(svg, data);
            }
        }

        function drawForceLayout(svg, data) {
            simulation = d3.forceSimulation(data.nodes)
                .force('link', d3.forceLink(data.links).id(d => d.id).distance(100))
                .force('charge', d3.forceManyBody().strength(-300))
                .force('center', d3.forceCenter(width / 2, height / 2))
                .force('collision', d3.forceCollide().radius(40));

            const link = svg.append('g')
                .selectAll('line')
                .data(data.links)
                .join('line')
                .attr('class', 'link')
                .attr('stroke-width', d => Math.sqrt(d.value) * 2);

            const node = svg.append('g')
                .selectAll('circle')
                .data(data.nodes)
                .join('circle')
                .attr('class', 'node')
                .attr('r', d => d.value / 2)
                .attr('fill', d => color(d.group))
                .call(drag(simulation))
                .on('click', (event, d) => showNodeInfo(d));

            const label = svg.append('g')
                .selectAll('text')
                .data(data.nodes)
                .join('text')
                .attr('class', 'label')
                .attr('text-anchor', 'middle')
                .attr('dy', '.35em')
                .text(d => d.id);

            simulation.on('tick', () => {
                link
                    .attr('x1', d => d.source.x)
                    .attr('y1', d => d.source.y)
                    .attr('x2', d => d.target.x)
                    .attr('y2', d => d.target.y);

                node
                    .attr('cx', d => d.x)
                    .attr('cy', d => d.y);

                label
                    .attr('x', d => d.x)
                    .attr('y', d => d.y);
            });
        }

        function drawRadialLayout(svg, data) {
            const radius = Math.min(width, height) / 2 - 80;
            const angleStep = (2 * Math.PI) / data.nodes.length;

            data.nodes.forEach((node, i) => {
                node.x = width / 2 + radius * Math.cos(i * angleStep - Math.PI / 2);
                node.y = height / 2 + radius * Math.sin(i * angleStep - Math.PI / 2);
            });

            const link = svg.append('g')
                .selectAll('line')
                .data(data.links)
                .join('line')
                .attr('class', 'link')
                .attr('stroke-width', d => Math.sqrt(d.value) * 2)
                .attr('x1', d => data.nodes.find(n => n.id === d.source).x)
                .attr('y1', d => data.nodes.find(n => n.id === d.source).y)
                .attr('x2', d => data.nodes.find(n => n.id === d.target).x)
                .attr('y2', d => data.nodes.find(n => n.id === d.target).y);

            const node = svg.append('g')
                .selectAll('circle')
                .data(data.nodes)
                .join('circle')
                .attr('class', 'node')
                .attr('cx', d => d.x)
                .attr('cy', d => d.y)
                .attr('r', 0)
                .attr('fill', d => color(d.group))
                .on('click', (event, d) => showNodeInfo(d))
                .transition()
                .duration(1000)
                .attr('r', d => d.value / 2);

            const label = svg.append('g')
                .selectAll('text')
                .data(data.nodes)
                .join('text')
                .attr('class', 'label')
                .attr('x', d => d.x)
                .attr('y', d => d.y)
                .attr('text-anchor', 'middle')
                .attr('dy', '.35em')
                .text(d => d.id)
                .style('opacity', 0)
                .transition()
                .duration(1000)
                .style('opacity', 1);
        }

        function drawTreeLayout(svg, data) {
            const root = d3.stratify()
                .id(d => d.id)
                .parentId(d => {
                    const link = data.links.find(l => l.target === d.id);
                    return link ? link.source : null;
                })(data.nodes);

            const treeLayout = d3.tree().size([width - 100, height - 100]);
            treeLayout(root);

            const link = svg.append('g')
                .selectAll('path')
                .data(root.links())
                .join('path')
                .attr('class', 'link')
                .attr('fill', 'none')
                .attr('stroke-width', 2)
                .attr('d', d3.linkVertical()
                    .x(d => d.x + 50)
                    .y(d => d.y + 50));

            const node = svg.append('g')
                .selectAll('circle')
                .data(root.descendants())
                .join('circle')
                .attr('class', 'node')
                .attr('cx', d => d.x + 50)
                .attr('cy', d => d.y + 50)
                .attr('r', d => d.data.value / 2)
                .attr('fill', d => color(d.data.group))
                .on('click', (event, d) => showNodeInfo(d.data));

            const label = svg.append('g')
                .selectAll('text')
                .data(root.descendants())
                .join('text')
                .attr('class', 'label')
                .attr('x', d => d.x + 50)
                .attr('y', d => d.y + 50)
                .attr('text-anchor', 'middle')
                .attr('dy', '.35em')
                .text(d => d.data.id);
        }

        function drag(simulation) {
            function dragstarted(event) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                event.subject.fx = event.subject.x;
                event.subject.fy = event.subject.y;
            }

            function dragged(event) {
                event.subject.fx = event.x;
                event.subject.fy = event.y;
            }

            function dragended(event) {
                if (!event.active) simulation.alphaTarget(0);
                event.subject.fx = null;
                event.subject.fy = null;
            }

            return d3.drag()
                .on('start', dragstarted)
                .on('drag', dragged)
                .on('end', dragended);
        }

        function showNodeInfo(node) {
            const connections = graphData.links.filter(function(l) {
                return l.source === node.id || l.target === node.id || 
                    l.source.id === node.id || l.target.id === node.id;
            }).length;

            document.querySelector('.info-panel').innerHTML = 
                '<h3>ðŸ“Š ' + node.id + '</h3>' +
                '<p><strong>Group:</strong> ' + node.group + ' | <strong>Value:</strong> ' + node.value + ' | <strong>Connections:</strong> ' + connections + '</p>';
        }

        function changeVisualization(type) {
            currentLayout = type;
            if (simulation) simulation.stop();
            
            document.querySelectorAll('.controls button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`btn-${type}`).classList.add('active');
            
            drawGraph();
        }

        function randomizeData() {
            graphData.nodes.forEach(node => {
                node.value = Math.floor(Math.random() * 30) + 10;
                node.group = Math.floor(Math.random() * 3) + 1;
            });
            drawGraph();
        }

        initGraph();
    </script>
</body>
</html>